# LAN Proxy Gateway

**ä¸åˆ·å›ºä»¶ã€ä¸ä¹°è½¯è·¯ç”±ï¼Œä¸€æ¡å‘½ä»¤æŠŠ Mac / Mac Mini å˜æˆå…¨å±‹ç§‘å­¦ä¸Šç½‘ç½‘å…³ã€‚**

Switch çœ‹ YouTubeã€Apple TV åˆ· Netflixã€PS5 è”æœºåŠ é€Ÿ â€”â€” åªè¦è®¾å¤‡èƒ½è¿ Wi-Fiï¼Œæ”¹ä¸ªç½‘å…³å°±èƒ½ç”¨ã€‚

```mermaid
graph TD
    Internet(("ğŸŒ äº’è”ç½‘"))
    Router["ğŸ”² è·¯ç”±å™¨<br/>192.168.x.1"]
    Mac["ğŸ–¥ Mac / Mac Mini<br/>è¿è¡Œ mihomo Â· 192.168.x.2"]
    Switch["ğŸ® Switch<br/>YouTube Â· eShop"]
    ATV["ğŸ“º Apple TV<br/>Netflix Â· Disney+"]
    PS5["ğŸ•¹ PS5 / Xbox<br/>PSN Â· è”æœºåŠ é€Ÿ"]
    TV["ğŸ“¡ æ™ºèƒ½ç”µè§†<br/>æµåª’ä½“"]
    Phone["ğŸ“± æ‰‹æœº / ç”µè„‘<br/>æ­£å¸¸ä¸Šç½‘"]

    Internet <--> Router
    Router <--> Mac
    Router <--> Phone
    Mac -- "ç½‘å…³ + DNS æŒ‡å‘ Mac IP" --> Switch
    Mac -- "ç½‘å…³ + DNS æŒ‡å‘ Mac IP" --> ATV
    Mac -- "ç½‘å…³ + DNS æŒ‡å‘ Mac IP" --> PS5
    Mac -- "ç½‘å…³ + DNS æŒ‡å‘ Mac IP" --> TV

    style Mac fill:#2d9e2d,color:#fff,stroke:#1a7a1a
    style Internet fill:#4a90d9,color:#fff,stroke:#2a6ab9
    style Router fill:#f5a623,color:#fff,stroke:#d4891a
    style Switch fill:#e60012,color:#fff,stroke:#b8000e
    style ATV fill:#555,color:#fff,stroke:#333
    style PS5 fill:#006fcd,color:#fff,stroke:#0055a0
    style TV fill:#8e44ad,color:#fff,stroke:#6c3483
    style Phone fill:#95a5a6,color:#fff,stroke:#7f8c8d
```

## ä¸ºä»€ä¹ˆåšè¿™ä¸ª

å®¶é‡Œæ€»æœ‰äº›è®¾å¤‡**è£…ä¸äº†ä»£ç†è½¯ä»¶**ï¼šSwitchã€Apple TVã€PS5ã€æ™ºèƒ½ç”µè§†â€¦â€¦

å¸¸è§æ–¹æ¡ˆæ˜¯åˆ·è·¯ç”±å™¨å›ºä»¶æˆ–ä¹°ä¸€å°è½¯è·¯ç”±ï¼Œä½†â€”â€”
- åˆ·å›ºä»¶æœ‰å˜ç –é£é™©ï¼Œé…ç½®å¤æ‚
- è½¯è·¯ç”±åˆè¦é¢å¤–èŠ±é’±ï¼Œè¿˜å åœ°æ–¹

å…¶å®ä½ çš„ **Macï¼ˆç‰¹åˆ«æ˜¯å¸¸å¹´å¼€ç€çš„ Mac Miniï¼‰** å°±æ˜¯æœ€å¥½çš„ç½‘å…³ã€‚è¿™ä¸ªé¡¹ç›®æŠŠæ•´ä¸ªè¿‡ç¨‹å°è£…æˆä¸‰æ¡å‘½ä»¤ï¼Œä¸éœ€è¦ä½ æ‡‚ç½‘ç»œçŸ¥è¯†ã€‚

## æ”¯æŒçš„è®¾å¤‡å’Œåœºæ™¯

| è®¾å¤‡ | åœºæ™¯ | æ•ˆæœ |
|------|------|------|
| **Nintendo Switch** | eShopã€YouTubeã€åœ¨çº¿è”æœº | ç›´è¿å›½é™…æœï¼Œçœ‹ YouTube æ— å‹åŠ› |
| **Apple TV** | Netflixã€Disney+ã€YouTubeã€HBO | 4K æµç•…æ’­æ”¾ï¼Œå‘Šåˆ«è½¬åœˆ |
| **PS5 / Xbox** | PSN å•†åº—ã€åœ¨çº¿å¯¹æˆ˜ã€ä¸‹è½½åŠ é€Ÿ | è”æœºç¨³å®šï¼Œä¸‹è½½æé€Ÿ |
| **æ™ºèƒ½ç”µè§†** | YouTubeã€Netflixã€æµåª’ä½“ App | å¤§å±è§‚å½±ä½“éªŒæ‹‰æ»¡ |
| **IoT è®¾å¤‡** | ä»»ä½•èƒ½æ”¹ç½‘å…³çš„è®¾å¤‡ | éƒ½èƒ½ç”¨ |

## å¿«é€Ÿå¼€å§‹

### ä½ éœ€è¦å‡†å¤‡

- ä¸€å° Macï¼ˆæ¨è Mac Mini å¸¸é©»è¿è¡Œï¼ŒMacBook ä¹Ÿè¡Œï¼‰
- [Homebrew](https://brew.sh/)ï¼ˆMac åŒ…ç®¡ç†å™¨ï¼‰
- ä¸€ä¸ªä»£ç†è®¢é˜…é“¾æ¥ï¼ˆæœºåœºæä¾›çš„ Clash/mihomo æ ¼å¼ URLï¼‰

### ä¸‰æ­¥å®Œæˆ

```bash
# 1. ä¸‹è½½
git clone https://github.com/Tght1211/lan-proxy-gateway.git
cd lan-proxy-gateway

# 2. å®‰è£…ï¼ˆä¼šå¼•å¯¼ä½ è¾“å…¥ï¿½ï¿½é˜…é“¾æ¥ï¼‰
bash install.sh

# 3. å¯åŠ¨
sudo ./start.sh
```

å¯åŠ¨åç»ˆç«¯ä¼šæ˜¾ç¤ºä½ çš„ Mac IPï¼ŒæŠŠå…¶ä»–è®¾å¤‡çš„**ç½‘å…³**å’Œ **DNS** æ”¹æˆè¿™ä¸ª IP å°±è¡Œäº†ã€‚

### æ—¥å¸¸ä½¿ç”¨

```bash
sudo ./start.sh    # å¯åŠ¨ç½‘å…³
./status.sh        # æŸ¥çœ‹çŠ¶æ€ï¼šèŠ‚ç‚¹ã€è¿æ¥æ•°ã€æµé‡
sudo ./stop.sh     # åœæ­¢ç½‘å…³
```

## è®¾å¤‡é…ç½®

å¯åŠ¨åï¼Œåœ¨éœ€è¦ç§‘å­¦ä¸Šç½‘çš„è®¾å¤‡ä¸Šï¼ŒæŠŠç½‘ç»œè®¾ç½®æ”¹ä¸º**æ‰‹åŠ¨**ï¼š

| è®¾ç½®é¡¹ | å¡«ä»€ä¹ˆ |
|--------|--------|
| IP åœ°å€ | åŒç½‘æ®µéšä¾¿ä¸€ä¸ªæ²¡ç”¨è¿‡çš„ IPï¼ˆå¦‚ `192.168.1.100`ï¼‰ |
| å­ç½‘æ©ç  | `255.255.255.0` |
| ç½‘å…³ | Mac çš„ IPï¼ˆ`start.sh` ä¼šå‘Šè¯‰ä½ ï¼‰ |
| DNS | Mac çš„ IPï¼ˆåŒä¸Šï¼‰ |

> **å„è®¾å¤‡è¯¦ç»†è®¾ç½®æŒ‡å—ï¼š**
> - [Nintendo Switch](docs/switch-setup.md)
> - [Apple TV](docs/appletv-setup.md)
> - [PS5 / Xbox](docs/ps5-setup.md)
> - [iPhone / Android æ‰‹æœº](docs/phone-setup.md)

## å·¥ä½œåŸç†

```mermaid
flowchart LR
    Device["ğŸ“± LAN è®¾å¤‡"] --> Mac["ğŸ–¥ Mac ç½‘å…³<br/>IP è½¬å‘"]
    Mac --> TUN["mihomo<br/>TUN è™šæ‹Ÿç½‘å¡"]
    TUN --> Rules{"æ™ºèƒ½åˆ†æµ"}
    Rules -- "å›½å†…æµé‡" --> Direct["ğŸ‡¨ğŸ‡³ ç›´è¿"]
    Rules -- "å›½å¤–æµé‡" --> Proxy["ğŸŒ ä»£ç†èŠ‚ç‚¹"]
    Rules -- "å¹¿å‘Š" --> Block["ğŸš« æ‹¦æˆª"]

    style Mac fill:#2d9e2d,color:#fff,stroke:#1a7a1a
    style TUN fill:#3498db,color:#fff,stroke:#2980b9
    style Rules fill:#f39c12,color:#fff,stroke:#d68910
    style Direct fill:#27ae60,color:#fff,stroke:#1e8449
    style Proxy fill:#8e44ad,color:#fff,stroke:#6c3483
    style Block fill:#e74c3c,color:#fff,stroke:#c0392b
```

1. Mac å¼€å¯ IP è½¬å‘ï¼Œå……å½“å±€åŸŸç½‘ç½‘å…³
2. mihomo ä»¥ TUN æ¨¡å¼è¿è¡Œï¼Œåˆ›å»ºè™šæ‹Ÿç½‘å¡é€æ˜æ¥ç®¡æ‰€æœ‰æµé‡
3. æ™ºèƒ½åˆ†æµï¼šå›½å†…ç½‘ç«™ç›´è¿ã€å›½å¤–èµ°ä»£ç†ã€å¹¿å‘Šç›´æ¥æ‹¦æˆª
4. èŠ‚ç‚¹é€šè¿‡ `proxy-providers` ä»ä½ çš„è®¢é˜…é“¾æ¥è‡ªåŠ¨æ‹‰å–ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

## éšç§å®‰å…¨

ä½ çš„è®¢é˜…é“¾æ¥æ˜¯æ•æ„Ÿä¿¡æ¯ã€‚æœ¬é¡¹ç›®åšäº†ä¸‰å±‚éš”ç¦»ï¼Œç¡®ä¿ä¸ä¼šæ³„éœ²ï¼š

| æ–‡ä»¶ | ä¼šä¸Šä¼  GitHub å— | å†…å®¹ |
|------|:---:|------|
| `config/template.yaml` | Yes | åªæœ‰é…ç½®æ¡†æ¶ï¼Œ`{{å˜é‡}}` å ä½ |
| `.secret` | **No** | ä½ çš„è®¢é˜… URLï¼Œä»…å­˜æœ¬åœ° |
| `data/config.yaml` | **No** | è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆï¼ŒåŒ…å«å®é™…é…ç½® |

## é¡¹ç›®ç»“æ„

```
lan-proxy-gateway/
â”œâ”€â”€ install.sh            # ä¸€é”®å®‰è£…å‘å¯¼
â”œâ”€â”€ start.sh              # å¯åŠ¨ç½‘å…³
â”œâ”€â”€ stop.sh               # åœæ­¢ç½‘å…³
â”œâ”€â”€ status.sh             # çŠ¶æ€é¢æ¿
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ common.sh         # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ detect.sh         # è‡ªåŠ¨æ£€æµ‹ï¼ˆç½‘å¡ã€IPã€æ¶æ„ï¼‰
â”‚   â””â”€â”€ config.sh         # é…ç½®æ¸²æŸ“
â”œâ”€â”€ config/
â”‚   â””â”€â”€ template.yaml     # mihomo é…ç½®æ¨¡æ¿
â”œâ”€â”€ .secret.example       # æ•æ„Ÿé…ç½®ç¤ºä¾‹
â””â”€â”€ docs/
    â”œâ”€â”€ switch-setup.md   # Switch è®¾ç½®æŒ‡å—
    â”œâ”€â”€ appletv-setup.md  # Apple TV è®¾ç½®æŒ‡å—
    â”œâ”€â”€ ps5-setup.md      # PS5 è®¾ç½®æŒ‡å—
    â””â”€â”€ phone-setup.md    # æ‰‹æœº/å¹³æ¿è®¾ç½®æŒ‡å—
```

## FAQ

**Q: å¿…é¡»ç”¨ Mac Mini å—ï¼Ÿ**
> ä¸æ˜¯ã€‚ä»»ä½• Mac éƒ½è¡Œï¼ŒMacBook ä¹Ÿå¯ä»¥ã€‚ä½† Mac Mini åŠŸè€—ä½ã€ä¸å åœ°æ–¹ã€å¸¸å¹´å¼€ç€åˆšå¥½ï¼Œæ˜¯æœ€é€‚åˆå½“ç½‘å…³çš„é€‰æ‹©ã€‚

**Q: ä¸ºä»€ä¹ˆè¦ sudoï¼Ÿ**
> TUN æ¨¡å¼éœ€è¦åˆ›å»ºè™šæ‹Ÿç½‘å¡å’Œä¿®æ”¹ç³»ç»Ÿè·¯ç”±è¡¨ï¼Œè¿™äº›æ˜¯ç³»ç»Ÿçº§æ“ä½œã€‚

**Q: Apple TV çœ‹ Netflix ä¼šå¡å—ï¼Ÿ**
> å–å†³äºä½ çš„ä»£ç†èŠ‚ç‚¹è´¨é‡ã€‚èŠ‚ç‚¹å¤Ÿå¿«çš„è¯ 4K æ²¡é—®é¢˜ã€‚å¯ä»¥é€šè¿‡ `status.sh` æˆ– Web é¢æ¿ï¼ˆ`http://Macçš„IP:9090/ui`ï¼‰åˆ‡æ¢èŠ‚ç‚¹ã€‚

**Q: Switch èƒ½çœ‹ YouTube å—ï¼Ÿ**
> å¯ä»¥ã€‚é…å¥½ç½‘å…³å Switch çš„ YouTube App å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

**Q: æ€ä¹ˆåˆ‡æ¢èŠ‚ç‚¹ï¼Ÿ**
> ä¸¤ç§æ–¹å¼ï¼š
> 1. æµè§ˆå™¨æ‰“å¼€ `http://Macçš„IP:9090/ui`ï¼ˆmihomo ç®¡ç†é¢æ¿ï¼‰
> 2. å‘½ä»¤è¡Œè¿è¡Œ `./status.sh` æŸ¥çœ‹å½“å‰èŠ‚ç‚¹

**Q: å…³æ‰ Mac åå…¶ä»–è®¾å¤‡æ€ä¹ˆåŠï¼Ÿ**
> éœ€è¦æŠŠè®¾å¤‡çš„ç½‘ç»œè®¾ç½®æ”¹å›"è‡ªåŠ¨è·å–"ï¼Œå¦åˆ™æ— æ³•ä¸Šç½‘ã€‚

**Q: å’Œè½¯è·¯ç”±æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ**
> | | LAN Proxy Gateway | è½¯è·¯ç”± |
> |---|---|---|
> | æˆæœ¬ | åˆ©ç”¨ç°æœ‰ Macï¼Œé›¶æˆæœ¬ | éœ€è¦é¢å¤–ä¹°è®¾å¤‡ |
> | é…ç½®éš¾åº¦ | ä¸‰æ¡å‘½ä»¤ | åˆ·å›ºä»¶ + é…ç½® OpenWrt |
> | ç¨³å®šæ€§ | Mac æœ‰æ—¶éœ€è¦é‡å¯/åˆç›– | ä¸“ç”¨è®¾å¤‡æ›´ç¨³å®š |
> | é€‚åˆåœºæ™¯ | å®¶é‡Œæœ‰ Mac Mini çš„ç”¨æˆ· | è¿½æ±‚ 7Ã—24 æè‡´ç¨³å®š |

## License

[MIT](LICENSE)
