# PS5 网络设置指南

在 Mac 上启动 LAN Proxy Gateway 后，按以下步骤配置 PS5。

## 前提

- Mac 已运行 `sudo ./start.sh` 且显示启动成功
- 记下 Mac 的局域网 IP（start.sh 输出会显示，例如 `192.168.1.2`）
- PS5 和 Mac 连接同一个 Wi-Fi / 路由器

## 设置步骤

### 1. 进入网络设置

```
设置 → 网络 → 设定网络连接
```

### 2. 选择 Wi-Fi

选择你的 Wi-Fi 网络，在弹出的选项中**不要直接连接**，而是选择右下角的 **手动设定**（或在已连接的网络上按 Options 键 → 设定）。

### 3. IP 地址设置

将 **IP 地址设定** 改为 **手动**：

| 设置项 | 值 | 说明 |
|--------|-----|------|
| IP 地址 | `192.168.x.104` | 同网段未使用的 IP（x 和 Mac 相同） |
| 子网掩码 | `255.255.255.0` | 保持默认 |
| 默认网关 | `192.168.x.2` | **Mac 的 IP** |

> 例：Mac IP 是 `192.168.1.2`，PS5 可设为 `192.168.1.104`，默认网关填 `192.168.1.2`

### 4. DNS 设置

将 **DNS 设定** 改为 **手动**：

| 设置项 | 值 |
|--------|-----|
| 主 DNS | Mac 的 IP（如 `192.168.1.2`） |
| 副 DNS | `8.8.8.8` |

### 5. 其他选项

| 设置项 | 值 |
|--------|-----|
| MTU 设定 | 自动 |
| 代理服务器 | **不使用** |

> 注意：不要设置代理服务器。流量通过网关的 TUN 模式透明转发，无需额外代理配置。

### 6. 测试网络连接

完成设置后，选择 **测试网络连接**。

应该看到：
- 获取 IP 地址：成功
- 网络连接：成功
- PlayStation Network 登录：成功

## 验证

### 在 PS5 上
- 打开 **PlayStation Store**，确认能正常浏览和加载
- 尝试进入一个在线游戏，确认联机功能正常
- 下载一个小文件，观察下载速度

### 在 Mac 上
```bash
# 查看代理状态
./status.sh

# 查看实时日志，应能看到 PS5 的连接
tail -f /tmp/lan-proxy-gateway.log
```

## NAT 类型说明

PS5 的 NAT 类型在 TUN 模式下通常显示为 **Type 2**（中等）或 **Type 3**（严格）。这是正常现象：

| NAT 类型 | 说明 |
|----------|------|
| Type 1 | 直连，通过网关无法达到 |
| **Type 2** | 中等，大部分游戏联机没问题 |
| **Type 3** | 严格，部分游戏语音聊天或 P2P 匹配可能受限 |

大部分在线游戏在 Type 2 下完全正常运行。如果遇到 Type 3 且联机有问题，可以尝试切换不同的代理节点。

## 恢复自动网络

停止代理网关后，PS5 网络需要改回去：

```
设置 → 网络 → 设定网络连接 → 选择你的 Wi-Fi
→ IP 地址设定：自动
→ DNS 设定：自动
→ 代理服务器：不使用
```

或者更简单的方式：删除该 Wi-Fi 连接并重新连接。

## 常见问题

### NAT 类型受限（Type 3）
这是通过网关代理的正常现象。大部分游戏仍能正常联机。如果特定游戏联机出现问题，可尝试在 mihomo 管理面板（`http://Mac的IP:9090/ui`）中切换不同的代理节点。

### PSN 商店打不开 / 加载缓慢
1. 确认 Mac 上 `./status.sh` 显示 mihomo 正在运行
2. 尝试切换代理节点，部分节点可能对 PSN 访问不佳
3. 可以通过 Web 面板 `http://Mac的IP:9090/ui` 切换到延迟更低的节点

### 下载速度慢
游戏下载速度取决于代理节点的带宽。建议：
1. 通过 `status.sh` 或 Web 面板测试各节点延迟
2. 切换到速度更快的节点
3. 如果只是下载游戏（不需要翻墙），可以临时把 PS5 网络改回自动，下载完再改回来

### 连不上 PlayStation Network
1. 确认 Mac 上网关正在运行
2. 确认 PS5 的默认网关和主 DNS 都填了 Mac 的 IP
3. 确认 IP 地址的前三段和 Mac 相同（如都是 `192.168.1.x`）
4. 确认代理服务器设置为"不使用"
