# Nintendo Switch 网络设置指南

在 Mac 上启动 LAN Proxy Gateway 后，按以下步骤配置 Switch。

## 前提

- Mac 已运行 `sudo ./start.sh` 且显示启动成功
- 记下 Mac 的局域网 IP（start.sh 输出会显示，例如 `192.168.1.2`）
- Switch 和 Mac 连接同一个 Wi-Fi / 路由器

## 设置步骤

### 1. 进入网络设置

```
主页 → 设置 → 互联网 → 互联网设置
```

### 2. 选择 Wi-Fi

选择你的 Wi-Fi 网络 → **更改设置**

### 3. IP 地址设置

将 **IP 地址设置** 改为 **手动**：

| 设置项 | 值 | 说明 |
|--------|-----|------|
| IP 地址 | `192.168.x.100` | 同网段未使用的 IP（x 和 Mac 相同） |
| 子网掩码 | `255.255.255.0` | 保持默认 |
| 网关 | `192.168.x.2` | **Mac 的 IP** |

> 例：Mac IP 是 `192.168.1.2`，Switch 可设为 `192.168.1.100`，网关填 `192.168.1.2`

### 4. DNS 设置

将 **DNS 设置** 改为 **手动**：

| 设置项 | 值 |
|--------|-----|
| 首选 DNS | Mac 的 IP（如 `192.168.1.2`） |
| 备选 DNS | `8.8.8.8`（可选，留空也行） |

### 5. 保存并测试

点击 **保存** → **连接到此网络**

测试连接应显示"已连接到互联网"。

## 验证

### 在 Switch 上
- eshop 能正常打开
- 在线游戏能正常连接

### 在 Mac 上
```bash
# 查看代理状态
./status.sh

# 查看实时日志，应能看到 Switch 的连接
tail -f /tmp/lan-proxy-gateway.log
```

## 恢复自动网络

停止代理网关后，Switch 网络需要改回去：

```
设置 → 互联网 → 互联网设置 → 你的 Wi-Fi → 更改设置
→ IP 地址设置：自动
→ DNS 设置：自动
```

或者更简单的方式：直接删除该 Wi-Fi 连接并重新连接。

## 常见问题

### 连接测试失败
1. 确认 Mac 上 `./status.sh` 显示 mihomo 正在运行
2. 确认 Switch 的网关和 DNS 都填了 Mac 的 IP
3. 确认 IP 地址的前三段和 Mac 相同（如都是 `192.168.1.x`）

### 能上网但 eshop 打不开
分流规则可能需要更新。检查 `config/template.yaml` 中 Nintendo 相关的规则是否完整。

### NAT 类型显示 D 或 F
TUN 模式下 NAT 类型可能不是 A/B，这属于正常现象。大部分在线游戏仍能正常运行。如对战有问题可尝试切换不同的代理节点。
