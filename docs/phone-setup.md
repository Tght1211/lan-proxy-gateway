# 手机 / 平板网络设置指南

在 Mac 上启动 LAN Proxy Gateway 后，按以下步骤配置 iPhone 或 Android 手机 / 平板。

配好之后，手机**不需要安装任何代理 App** 也能科学上网，特别适合给家人的设备配置——他们完全无感，打开 Google、YouTube 就能直接用。

## 前提

- Mac 已运行 `sudo ./start.sh` 且显示启动成功
- 记下 Mac 的局域网 IP（start.sh 输出会显示，例如 `192.168.1.2`）
- 手机 / 平板和 Mac 连接同一个 Wi-Fi / 路由器

## iOS（iPhone / iPad）设置步骤

### 1. 进入 Wi-Fi 设置

```
设置 → Wi-Fi
```

### 2. 进入网络详情

点击已连接网络名称右侧的 **(i)** 按钮。

### 3. IP 地址设置

将 **配置 IP** 改为 **手动**：

| 设置项 | 值 | 说明 |
|--------|-----|------|
| IP 地址 | `192.168.x.102` | 同网段未使用的 IP（x 和 Mac 相同） |
| 子网掩码 | `255.255.255.0` | 保持默认 |
| 路由器 | `192.168.x.2` | **Mac 的 IP** |

> 例：Mac IP 是 `192.168.1.2`，iPhone 可设为 `192.168.1.102`，路由器填 `192.168.1.2`

### 4. DNS 设置

返回网络详情页，将 **配置 DNS** 改为 **手动**：

- 删除现有的 DNS 服务器
- 点击 **添加服务器**，填入 Mac 的 IP（如 `192.168.1.2`）

### 5. 保存

点击右上角 **存储**，完成配置。

---

## Android 手机 / 平板设置步骤

> 不同品牌的 Android 设置界面略有差异，以下以原生 Android / 通用流程为准。

### 1. 进入 WLAN 设置

```
设置 → WLAN（或 Wi-Fi）
```

### 2. 修改网络配置

**长按**已连接的 Wi-Fi 网络名称 → 选择 **修改网络**（部分机型是点击网络名称旁的设置图标）。

### 3. 展开高级选项

勾选 **显示高级选项**（或点击 **高级**）。

### 4. IP 设置

将 **IP 设置** 从 DHCP 改为 **静态**：

| 设置项 | 值 | 说明 |
|--------|-----|------|
| IP 地址 | `192.168.x.103` | 同网段未使用的 IP（x 和 Mac 相同） |
| 网关 | `192.168.x.2` | **Mac 的 IP** |
| 网络前缀长度 | `24` | 即 255.255.255.0 |
| DNS 1 | `192.168.x.2` | **Mac 的 IP** |
| DNS 2 | `8.8.8.8` | 可选，留空也行 |

> 例：Mac IP 是 `192.168.1.2`，手机 IP 设为 `192.168.1.103`，网关和 DNS 1 都填 `192.168.1.2`

### 5. 保存

点击 **保存**，完成配置。

---

## 验证

### 在手机上
- 打开浏览器访问 [google.com](https://google.com)，确认能正常加载
- 打开 **YouTube** App，播放一个视频测试
- 打开 **Twitter / Instagram** 等 App 测试

### 在 Mac 上
```bash
# 查看代理状态
./status.sh

# 查看实时日志，应能看到手机的连接
tail -f /tmp/lan-proxy-gateway.log
```

## 恢复自动网络

停止代理网关后，手机网络需要改回去：

### iOS
```
设置 → Wi-Fi → 点击 (i) → 配置 IP → 自动 → 配置 DNS → 自动
```

### Android
```
设置 → WLAN → 长按网络 → 修改网络 → 高级选项 → IP 设置改回 DHCP
```

或者更简单的方式：忘记该 Wi-Fi 网络并重新连接。

## 常见问题

### 部分 App 检测到代理
TUN 模式是系统级透明代理，一般不会被 App 检测到。如果个别 App 提示"正在使用代理"，通常不影响使用，可以忽略。

### 国内 App 会变慢吗？
不会。mihomo 配置了智能分流规则，国内流量走直连，不经过代理节点，速度和平时一样。只有访问国外网站时才走代理。

### 配置后完全无法上网
1. 确认 Mac 上 `./status.sh` 显示 mihomo 正在运行
2. 确认手机的网关和 DNS 都填了 Mac 的 IP
3. 确认 IP 地址的前三段和 Mac 相同（如都是 `192.168.1.x`）
4. 尝试关闭 Wi-Fi 再重新打开

### 家人的手机怎么配最省心？
配好一次之后，只要 Mac 网关一直开着，手机就一直能用，家人完全无感。唯一需要注意的是：如果 Mac 关机或网关停止了，手机需要改回自动获取 IP，否则会断网。
